@model Ecommerce_Project.ViewModels.UserProductViewModel

@{
    ViewData["Title"] = "Details";
}

<body>
<h1>Details</h1>

<div>
    <h4>UserProductViewModel</h4>
    <hr />
    <dl class="row">
        <dt class = "col-sm-2">
            @Html.LabelFor(model => model.Name,new {data_id=Model.ProductId})
        </dt>
        <dd class = "col-sm-10">@Html.DisplayFor(model => model.Name)</dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Description)
        </dt>
        <dd class="col-sm-10">@Html.DisplayFor(model => model.Description)</dd>
       
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Price)
        </dt>
        <dd class = "col-sm-10">@Html.DisplayFor(model => model.Price)</dd>
    </dl>

        <button class="btn btn-warning btnaddtocart" data-id="btn" id="btnaddtocart">
            Add To Cart
        </button>
</div>
<div>
   
    <a asp-action="Index">Back to List</a>
</div>
</body>
@section scripts{
    <script type="text/javascript">
      
        // the rest of your code to get the data.productId set

       
        var id;
        var productId =0;
        var productname;
        var productprice;
        var productdescription;
        var productidincart;
        $(document).ready(function () {


            $(".btnaddtocart").click(function () {
               
                let products = [];
                if (localStorage.getItem('products')) {
                    products = JSON.parse(localStorage.getItem('products'));
                    productstring = JSON.stringify(products)

                }
              // var m = JSON.parse(localStorage.getItem("products"));
                //console.log("m is "+m);
              //  console.log("m of 0 is "+m[0]);
               // console.log("m of 1 price is "+ m[1].price);
              //  var n = JSON.stringify(m)



               
                
            id = $(this).prev().find("label").attr('data-id');
           
            productname = $(this).prev().children().eq(1).text()
            productdescription = $(this).prev().children().eq(3).text()
            productprice = $(this).prev().children().eq(5).text()

                var m = JSON.parse(localStorage.getItem("products"));
                for (i = 0; i < m.length; i++) {
                    if (id in m[i].productId) {
                        console.log("loop has terminated")
                        break;
                    }
                }
                
                if (id in m)
                {
                    alert("found")
                }
                var result = m.filter(checkproduct);
                console.log(result)

                function checkproduct(id, index, value) {
                    if(id == value.productId)
                    {
                        return id
                    }
            }
               // addtoCart()
           $.each(m, function (index, value) {
                    /*alert(index + ": " + value.productId + '<br>');*/
                    if (id != value.productId)
                    {
                          //console.log("product does not exist")
                      // addtoCart()
                    }
                    else
                    {
                      // console.log("product exist")
                    }
             });
                if (localStorage.getItem('products') !== null) {
                    var arrayOfProducts = localStorage.getItem('products');
                    var existingProducts = _.filter(arrayOfProducts, function (product) { return product.productId === id });
                    console.log(existingProducts)
                    if (existingProducts.length > 0) {
                        console.log("product found")
                    }
                    else{
                        console.log("product not found")
                    }
                }
            
        
            /* for (i = 0; i < m.length; i++) { 
                    if ((m[i].productId == id))
                    {
                        console.log("loop has terminated")
                         break;
                    }
             }*/
                
            });

            function addtoCart(){
                productId = id;
                let products = [];
                if (localStorage.getItem('products')) {
                    products = JSON.parse(localStorage.getItem('products'));

                }

                products.push({ 'productId': productId, name: productname, price: productprice, description: productdescription });
                localStorage.setItem('products', JSON.stringify(products));
            }
        });
    </script>
}
